# 知识炼金术师项目总结

## 项目概述

知识炼金术师是一个基于LangGraph和DeepSeek API的AI系统，旨在与个人知识库（如Obsidian vault）深度集成。它使用"LLM作为检索器"的方法，在新信息与现有知识之间创建有意义的连接，生成遵循原子化、链接化思维原则的新笔记。

## 项目结构

```
knowledge-alchemist-langgraph/
├── .env                   # 您的秘密API密钥
├── .env.example           # 环境变量示例文件
├── config.py              # 路径和模型的主要配置
├── requirements.txt       # 项目依赖
├── README.md              # 项目说明文档
├── simple_llm_test.py     # 简单的LLM测试脚本
├── final_test.py          # 最终测试脚本
├── test_system.py         # 系统测试脚本
├── simple_test.py         # 简单测试脚本
├── debug_test.py          # 调试测试脚本
├── minimal_test.py        # 最小化测试脚本
├── test_indexer.py        # 索引器测试脚本
├── src/
│   ├── __init__.py        # Python包初始化文件
│   ├── storage.py         # 管理推理索引的SQLite数据库
│   ├── prompts.py         # 存储所有核心系统提示
│   ├── indexer.py         # 构建和监视索引的逻辑
│   ├── graph.py           # 核心LangGraph定义和节点
│   └── main.py            # 通过API暴露逻辑的FastAPI服务器
├── data/                  # 存储SQLite数据库的目录
│   └── reasoning_index.db # 推理索引数据库
└── lang_vault/
    └── lang-vault/        # Obsidian vault目录
        ├── 测试笔记.md     # 测试笔记文件
        └── .obsidian/     # Obsidian配置目录
```

## 核心组件

### 1. 配置模块 (config.py)
- 定义项目核心路径
- 配置模型参数
- 设置检索器参数

### 2. 存储模块 (storage.py)
- 管理SQLite数据库
- 存储和检索知识指纹
- 提供BM25搜索功能

### 3. 提示模块 (prompts.py)
- 定义所有核心系统提示
- 包括指纹提炼、推理匹配和笔记合成提示

### 4. 索引器模块 (indexer.py)
- 扫描Vault构建初始推理索引
- 监视文件更改保持索引最新
- 处理单个笔记文件生成指纹

### 5. 图模块 (graph.py)
- 定义LangGraph核心逻辑
- 实现处理新文章的有状态图
- 包含五个核心节点：指纹提炼、候选筛选、推理重排序、上下文获取、笔记合成

### 6. 主模块 (main.py)
- 通过FastAPI暴露系统功能
- 提供RESTful API接口

## 核心架构

系统的逻辑使用LangGraph定义为有状态图。当处理新文章时，系统会经历以下状态和操作：

1. **提炼指纹**：使用DeepSeek LLM读取新文章并将其精髓提炼为密集的、AI可读的"推理指纹"。

2. **筛选候选**：在预构建的所有现有笔记指纹索引上执行快速的基于关键词的搜索(BM25)。

3. **推理与重排序**：使用LLM执行逻辑推理任务，比较新文章的指纹与候选指纹并返回最相关笔记的排序列表。

4. **获取上下文**：从知识库中检索排名靠前的笔记的完整文本。

5. **合成笔记**：使用原始文章和检索到的上下文笔记来合成一个新的、原子化的和互联的笔记。

## 技术栈

- **核心框架**：LangGraph, LangChain
- **语言模型**：DeepSeek (deepseek-chat)
- **Web框架**：FastAPI
- **数据库**：SQLite
- **文件监视**：Watchdog
- **搜索**：BM25
- **其他**：python-dotenv, pydantic

## 使用说明

### 安装依赖
```bash
pip install -r requirements.txt
```

### 配置环境
1. 复制`.env.example`到`.env`
2. 在`.env`中添加您的DeepSeek API密钥
3. 在`config.py`中设置您的Obsidian vault路径

### 运行系统
系统有两个主要组件需要分别运行：

1. **索引器与监视器**：
```bash
python3 src/indexer.py
```

2. **FastAPI服务器**：
```bash
uvicorn src.main:app --reload
```

### API使用
向`http://127.0.0.1:8000/process-article`发送POST请求：
```json
{
  "text": "您的新文章内容在这里...",
  "source_url": "http://example.com/article"
}
```

## 测试验证

项目包含多个测试脚本以验证各组件功能：
- `simple_llm_test.py`：验证LLM连接
- `final_test.py`：综合功能测试
- `test_system.py`：系统功能测试

## 项目特点

1. **中文支持**：所有提示和说明均使用中文，便于理解和修改
2. **模块化设计**：清晰的模块划分，便于维护和扩展
3. **类型安全**：使用Python类型提示确保代码质量
4. **环境隔离**：通过.env文件管理敏感信息
5. **实时同步**：文件监视机制保持索引与vault同步

## 后续改进方向

1. 增强错误处理和日志记录
2. 添加更多测试用例
3. 优化BM25搜索算法
4. 支持更多文件格式
5. 添加Web界面
6. 增强笔记合成逻辑